# 03 - æ ¸å¿ƒå¼€å‘æŒ‡å—

## ğŸ—ï¸ æ ¸å¿ƒæ¨¡å—å®ç°

### 1. æ•°æ®æ¨¡å‹å±‚

#### UserPreference.kt - ç”¨æˆ·åå¥½å®ä½“

```kotlin
// data/local/UserPreference.kt
@Entity(tableName = "user_preferences")
data class UserPreference(
    @PrimaryKey(autoGenerate = true)
    val id: Long = 0,
    
    // é¥®é£Ÿåå¥½
    val favoriteCuisines: String = "",      // å–œæ¬¢çš„èœç³»ï¼Œå¦‚ "å·èœ,ç²¤èœ"
    val dislikedFoods: String = "",         // ä¸å–œæ¬¢çš„é£Ÿç‰©
    val dietaryRestrictions: String = "",   // é¥®é£Ÿé™åˆ¶ï¼ˆç´ é£Ÿã€æ¸…çœŸç­‰ï¼‰
    val spiceLevel: Int = 2,                // è¾£åº¦åå¥½ 1-5
    
    // ç”¨é¤ä¹ æƒ¯
    val preferredMealTimes: String = "",    // ç”¨é¤æ—¶é—´åå¥½
    val portionSize: String = "medium",     // åˆ†é‡åå¥½
    
    // å†å²è®°å½•ï¼ˆJSON æ ¼å¼å­˜å‚¨ï¼‰
    val recentFoods: String = "",           // æœ€è¿‘åƒè¿‡çš„é£Ÿç‰©
    val favoriteRestaurants: String = "",   // å–œæ¬¢çš„é¤å…
    
    // å…ƒæ•°æ®
    val updatedAt: Long = System.currentTimeMillis()
)
```

#### Recommendation.kt - æ¨èç»“æœ

```kotlin
// data/model/Recommendation.kt
data class Recommendation(
    val id: String = UUID.randomUUID().toString(),
    val foodName: String,                   // é£Ÿç‰©åç§°
    val cuisine: String,                    // èœç³»
    val reason: String,                     // æ¨èç†ç”±
    val confidence: Float,                  // ç½®ä¿¡åº¦ 0-1
    val estimatedPrice: Int?,               // é¢„ä¼°ä»·æ ¼
    val nutrition: NutritionInfo? = null,   // è¥å…»ä¿¡æ¯
    val imageUrl: String? = null,           // å‚è€ƒå›¾ç‰‡
    val timestamp: Long = System.currentTimeMillis()
)

data class NutritionInfo(
    val calories: Int,      // å¡è·¯é‡Œ
    val protein: Float,     // è›‹ç™½è´¨(g)
    val carbs: Float,       // ç¢³æ°´(g)
    val fat: Float          // è„‚è‚ª(g)
)
```

### 2. æ•°æ®åº“å±‚ (Room)

#### AppDatabase.kt

```kotlin
// data/local/AppDatabase.kt
@Database(
    entities = [UserPreference::class, FoodHistory::class],
    version = 1,
    exportSchema = false
)
abstract class AppDatabase : RoomDatabase() {
    abstract fun preferenceDao(): PreferenceDao
    abstract fun historyDao(): FoodHistoryDao
    
    companion object {
        @Volatile
        private var INSTANCE: AppDatabase? = null
        
        fun getDatabase(context: Context): AppDatabase {
            return INSTANCE ?: synchronized(this) {
                val instance = Room.databaseBuilder(
                    context.applicationContext,
                    AppDatabase::class.java,
                    "food_assistant.db"
                )
                .addCallback(object : RoomDatabase.Callback() {
                    override fun onCreate(db: SupportSQLiteDatabase) {
                        super.onCreate(db)
                        // é¢„æ’å…¥é»˜è®¤åå¥½
                        ioThread {
                            getDatabase(context).preferenceDao()
                                .insert(UserPreference())
                        }
                    }
                })
                .build()
                INSTANCE = instance
                instance
            }
        }
    }
}
```

#### PreferenceDao.kt

```kotlin
// data/local/PreferenceDao.kt
@Dao
interface PreferenceDao {
    
    @Query("SELECT * FROM user_preferences LIMIT 1")
    suspend fun getPreference(): UserPreference?
    
    @Insert(onConflict = OnConflictStrategy.REPLACE)
    suspend fun insert(preference: UserPreference): Long
    
    @Update
    suspend fun update(preference: UserPreference)
    
    @Query("UPDATE user_preferences SET 
            favoriteCuisines = :cuisines, 
            updatedAt = :timestamp 
            WHERE id = :id")
    suspend fun updateCuisines(id: Long, cuisines: String, timestamp: Long)
    
    @Query("UPDATE user_preferences SET 
            recentFoods = :foods, 
            updatedAt = :timestamp 
            WHERE id = :id")
    suspend fun updateRecentFoods(id: Long, foods: String, timestamp: Long)
}
```

### 3. æç¤ºè¯æ„å»ºå™¨

```kotlin
// prompt/PromptBuilder.kt
class PromptBuilder(private val context: Context) {
    
    /**
     * æ„å»ºå®Œæ•´æç¤ºè¯
     */
    fun buildPrompt(
        imageDescription: String?,
        userQuery: String?,
        preferences: UserPreference?,
        recentFoods: List<String>
    ): String {
        val sb = StringBuilder()
        
        // ç³»ç»Ÿè§’è‰²è®¾å®š
        sb.appendLine("ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„é¤é£Ÿæ¨èåŠ©æ‰‹ï¼Œç²¾é€šå„ç§èœç³»å’Œè¥å…»æ­é…ã€‚")
        sb.appendLine()
        
        // ç”¨æˆ·åå¥½ä¸Šä¸‹æ–‡
        sb.appendLine("## ç”¨æˆ·é¥®é£Ÿåå¥½")
        if (preferences != null) {
            sb.appendLine("- å–œæ¬¢çš„èœç³»ï¼š${preferences.favoriteCuisines.ifEmpty { "æ— ç‰¹åˆ«åå¥½" }}")
            sb.appendLine("- ä¸å–œæ¬¢çš„é£Ÿç‰©ï¼š${preferences.dislikedFoods.ifEmpty { "æ— " }}")
            sb.appendLine("- é¥®é£Ÿé™åˆ¶ï¼š${preferences.dietaryRestrictions.ifEmpty { "æ— " }}")
            sb.appendLine("- è¾£åº¦åå¥½ï¼š${spiceLevelToText(preferences.spiceLevel)}")
            sb.appendLine("- åˆ†é‡åå¥½ï¼š${preferences.portionSize}")
        } else {
            sb.appendLine("- æš‚æ— è®°å½•ï¼Œè¯·æ ¹æ®å¸¸è§å£å‘³æ¨è")
        }
        sb.appendLine()
        
        // æœ€è¿‘ç”¨é¤è®°å½•
        sb.appendLine("## æœ€è¿‘ç”¨é¤è®°å½•")
        if (recentFoods.isNotEmpty()) {
            recentFoods.take(5).forEachIndexed { index, food ->
                sb.appendLine("${index + 1}. $food")
            }
            sb.appendLine("ï¼ˆå»ºè®®æ¨èä¸åŒç§ç±»ä»¥è·å¾—è¥å…»å‡è¡¡ï¼‰")
        } else {
            sb.appendLine("- æ— è®°å½•")
        }
        sb.appendLine()
        
        // å½“å‰åœºæ™¯
        sb.appendLine("## å½“å‰åœºæ™¯")
        if (imageDescription != null) {
            sb.appendLine("ç”¨æˆ·ä¸Šä¼ äº†ä¸€å¼ å›¾ç‰‡ï¼Œå†…å®¹æè¿°ï¼š$imageDescription")
        }
        if (userQuery != null) {
            sb.appendLine("ç”¨æˆ·è¾“å…¥ï¼š\"$userQuery\"")
        }
        if (imageDescription == null && userQuery == null) {
            sb.appendLine("ç”¨æˆ·æ²¡æœ‰æä¾›å…·ä½“è¾“å…¥ï¼Œè¯·æ ¹æ®æ—¶é—´å’Œåå¥½ä¸»åŠ¨æ¨è")
        }
        sb.appendLine()
        
        // è¾“å‡ºè¦æ±‚
        sb.appendLine("## æ¨èè¦æ±‚")
        sb.appendLine("è¯·æä¾›ä»¥ä¸‹æ ¼å¼çš„æ¨èï¼š")
        sb.appendLine()
        sb.appendLine("ã€æ¨èèœå“ã€‘èœå“åç§°")
        sb.appendLine("ã€æ‰€å±èœç³»ã€‘èœç³»åç§°")
        sb.appendLine("ã€æ¨èç†ç”±ã€‘2-3å¥è¯è¯´æ˜ä¸ºä»€ä¹ˆæ¨èè¿™é“èœ")
        sb.appendLine("ã€è¥å…»ä¿¡æ¯ã€‘é¢„ä¼°å¡è·¯é‡Œå’Œä¸»è¦è¥å…»æˆåˆ†")
        sb.appendLine("ã€å‚è€ƒä»·æ ¼ã€‘é¢„ä¼°ä»·æ ¼åŒºé—´ï¼ˆå¦‚æœ‰æŠŠæ¡ï¼‰")
        sb.appendLine()
        sb.appendLine("æ³¨æ„ï¼š")
        sb.appendLine("1. è€ƒè™‘ç”¨æˆ·çš„å£å‘³åå¥½å’Œé¥®é£Ÿé™åˆ¶")
        sb.appendLine("2. é¿å…æ¨èç”¨æˆ·æœ€è¿‘åƒè¿‡çš„ç±»ä¼¼é£Ÿç‰©")
        sb.appendLine("3. å¦‚æœç”¨æˆ·ä¸Šä¼ äº†å›¾ç‰‡ï¼Œä¼˜å…ˆè€ƒè™‘ä¸å›¾ç‰‡ç›¸å…³çš„èœå“æˆ–ç±»ä¼¼é£æ ¼")
        sb.appendLine("4. è¯­æ°”è¦äº²åˆ‡è‡ªç„¶ï¼Œåƒæœ‹å‹ç»™å»ºè®®")
        
        return sb.toString()
    }
    
    /**
     * ä» AI å“åº”ä¸­è§£ææ¨èç»“æœ
     */
    fun parseRecommendation(response: String): Recommendation? {
        try {
            val foodName = extractField(response, "æ¨èèœå“") ?: return null
            val cuisine = extractField(response, "æ‰€å±èœç³»") ?: "æœªçŸ¥"
            val reason = extractField(response, "æ¨èç†ç”±") ?: ""
            
            return Recommendation(
                foodName = foodName.trim(),
                cuisine = cuisine.trim(),
                reason = reason.trim(),
                confidence = 0.85f
            )
        } catch (e: Exception) {
            Log.e("PromptBuilder", "Failed to parse recommendation", e)
            return null
        }
    }
    
    /**
     * æå–åå¥½æ›´æ–°ï¼ˆç”¨äºå­¦ä¹ ï¼‰
     */
    fun extractPreferences(response: String): Map<String, String> {
        val preferences = mutableMapOf<String, String>()
        
        // ç®€å•è§„åˆ™æå–ï¼šä» AI å“åº”ä¸­è¯†åˆ«ç”¨æˆ·çš„å–œå¥½
        val likePattern = "å–œæ¬¢(.+?)(?:ï¼Œ|ã€‚|ï¼›|\n)".toRegex()
        likePattern.findAll(response).forEach { match ->
            preferences["like_${match.groupValues[1].hashCode()}"] = match.groupValues[1]
        }
        
        return preferences
    }
    
    private fun extractField(text: String, fieldName: String): String? {
        val pattern = "ã€$fieldNameã€‘(.+?)(?=ã€|$)".toRegex(RegexOption.DOT_MATCHES_ALL)
        return pattern.find(text)?.groupValues?.get(1)?.trim()
    }
    
    private fun spiceLevelToText(level: Int): String {
        return when (level) {
            1 -> "ä¸è¾£"
            2 -> "å¾®è¾£"
            3 -> "ä¸­è¾£"
            4 -> "è¾ƒè¾£"
            5 -> "ç‰¹è¾£"
            else -> "é€‚ä¸­"
        }
    }
}
```

### 4. ä¸šåŠ¡é€»è¾‘å±‚ (ViewModel)

```kotlin
// ui/MainViewModel.kt
class MainViewModel(application: Application) : AndroidViewModel(application) {
    
    private val model: Qwen2VLModel = Qwen2VLModel(application)
    private val promptBuilder: PromptBuilder = PromptBuilder(application)
    private val db: AppDatabase = AppDatabase.getDatabase(application)
    
    // çŠ¶æ€
    private val _uiState = MutableStateFlow<UiState>(UiState.Idle)
    val uiState: StateFlow<UiState> = _uiState.asStateFlow()
    
    private val _recommendations = MutableStateFlow<List<Recommendation>>(emptyList())
    val recommendations: StateFlow<List<Recommendation>> = _recommendations.asStateFlow()
    
    private val _isModelReady = MutableStateFlow(false)
    val isModelReady: StateFlow<Boolean> = _isModelReady.asStateFlow()
    
    init {
        viewModelScope.launch {
            // æ£€æŸ¥/ä¸‹è½½æ¨¡å‹
            initializeModel()
        }
    }
    
    private suspend fun initializeModel() {
        _uiState.value = UiState.Loading("æ­£åœ¨å‡†å¤‡AIæ¨¡å‹...")
        
        val modelFile = File(getApplication<Application>().filesDir, "models/Qwen2-VL-2B-Int4.mnn")
        
        if (!modelFile.exists()) {
            _uiState.value = UiState.ModelNotFound
            return
        }
        
        val success = withContext(Dispatchers.Default) {
            model.initialize()
        }
        
        _isModelReady.value = success
        _uiState.value = if (success) UiState.Ready else UiState.Error("æ¨¡å‹åˆå§‹åŒ–å¤±è´¥")
    }
    
    /**
     * è·å–é¤é£Ÿæ¨èï¼ˆä¸»å…¥å£ï¼‰
     */
    fun getRecommendation(image: Bitmap? = null, textQuery: String? = null) {
        if (!_isModelReady.value) {
            _uiState.value = UiState.Error("æ¨¡å‹æœªå°±ç»ª")
            return
        }
        
        viewModelScope.launch {
            _uiState.value = UiState.Loading("æ­£åœ¨åˆ†æ...")
            
            try {
                // 1. è·å–ç”¨æˆ·åå¥½
                val preferences = db.preferenceDao().getPreference()
                
                // 2. è·å–æœ€è¿‘ç”¨é¤è®°å½•
                val recentFoods = db.historyDao().getRecentFoods(10).map { it.foodName }
                
                // 3. å›¾ç‰‡æè¿°ï¼ˆå¦‚æœæœ‰å›¾ç‰‡ï¼‰
                var imageDescription: String? = null
                if (image != null) {
                    _uiState.value = UiState.Loading("æ­£åœ¨è¯†åˆ«å›¾ç‰‡...")
                    imageDescription = describeImage(image)
                }
                
                // 4. æ„å»ºæç¤ºè¯
                val prompt = promptBuilder.buildPrompt(
                    imageDescription = imageDescription,
                    userQuery = textQuery,
                    preferences = preferences,
                    recentFoods = recentFoods
                )
                
                // 5. è¿è¡Œæ¨ç†
                _uiState.value = UiState.Loading("æ­£åœ¨ç”Ÿæˆæ¨è...")
                val response = withContext(Dispatchers.Default) {
                    model.inference(image ?: createDummyBitmap(), prompt)
                }
                
                // 6. è§£æç»“æœ
                val recommendation = promptBuilder.parseRecommendation(response)
                
                if (recommendation != null) {
                    _recommendations.value = listOf(recommendation)
                    
                    // 7. ä¿å­˜åˆ°å†å²
                    saveToHistory(recommendation, image)
                    
                    _uiState.value = UiState.Success
                } else {
                    _uiState.value = UiState.Error("è§£ææ¨èå¤±è´¥ï¼Œè¯·é‡è¯•")
                }
                
            } catch (e: Exception) {
                Log.e("MainViewModel", "Recommendation failed", e)
                _uiState.value = UiState.Error("æ¨ç†å‡ºé”™ï¼š${e.message}")
            }
        }
    }
    
    /**
     * å¿«é€Ÿæ¨èï¼ˆæ— è¾“å…¥ï¼‰
     */
    fun quickRecommend() {
        val timeContext = getTimeContext()
        getRecommendation(textQuery = timeContext)
    }
    
    /**
     * æ›´æ–°ç”¨æˆ·åå¥½
     */
    fun updatePreference(update: (UserPreference) -> UserPreference) {
        viewModelScope.launch {
            val current = db.preferenceDao().getPreference() ?: UserPreference()
            val updated = update(current).copy(updatedAt = System.currentTimeMillis())
            db.preferenceDao().insert(updated)
        }
    }
    
    /**
     * åé¦ˆï¼šå–œæ¬¢è¿™æ¬¡æ¨è
     */
    fun likeRecommendation(recommendation: Recommendation) {
        viewModelScope.launch {
            // æ›´æ–°åå¥½ï¼šè®°å½•å–œæ¬¢çš„èœç³»
            updatePreference { pref ->
                val currentCuisines = pref.favoriteCuisines.split(",").filter { it.isNotEmpty() }
                if (recommendation.cuisine !in currentCuisines) {
                    pref.copy(
                        favoriteCuisines = (currentCuisines + recommendation.cuisine).joinToString(",")
                    )
                } else pref
            }
            
            // æ›´æ–°å†å²è®°å½•
            db.historyDao().updateFeedback(recommendation.id, liked = true)
        }
    }
    
    /**
     * åé¦ˆï¼šä¸å–œæ¬¢è¿™æ¬¡æ¨è
     */
    fun dislikeRecommendation(recommendation: Recommendation) {
        viewModelScope.launch {
            db.historyDao().updateFeedback(recommendation.id, liked = false)
        }
    }
    
    private suspend fun describeImage(image: Bitmap): String {
        // ä½¿ç”¨ç®€åŒ–ç‰ˆæ¨ç†è·å–å›¾ç‰‡æè¿°
        val descPrompt = "æè¿°è¿™å¼ å›¾ç‰‡ä¸­çš„é£Ÿç‰©ï¼š"
        return withContext(Dispatchers.Default) {
            model.inference(image, descPrompt)
        }
    }
    
    private suspend fun saveToHistory(recommendation: Recommendation, image: Bitmap?) {
        val history = FoodHistory(
            foodName = recommendation.foodName,
            cuisine = recommendation.cuisine,
            timestamp = System.currentTimeMillis(),
            imagePath = image?.let { saveImage(it) }
        )
        db.historyDao().insert(history)
    }
    
    private fun saveImage(bitmap: Bitmap): String {
        val file = File(getApplication<Application>().filesDir, "images/${UUID.randomUUID()}.jpg")
        file.parentFile?.mkdirs()
        file.outputStream().use {
            bitmap.compress(Bitmap.CompressFormat.JPEG, 85, it)
        }
        return file.absolutePath
    }
    
    private fun getTimeContext(): String {
        val hour = Calendar.getInstance().get(Calendar.HOUR_OF_DAY)
        val mealType = when (hour) {
            in 6..10 -> "æ—©é¤"
            in 11..14 -> "åˆé¤"
            in 17..21 -> "æ™šé¤"
            else -> "å¤œå®µ"
        }
        return "è¯·ä¸ºæˆ‘æ¨è$mealType"
    }
    
    private fun createDummyBitmap(): Bitmap {
        return Bitmap.createBitmap(448, 448, Bitmap.Config.ARGB_8888)
    }
    
    override fun onCleared() {
        super.onCleared()
        model.release()
    }
    
    // UI çŠ¶æ€å®šä¹‰
    sealed class UiState {
        object Idle : UiState()
        data class Loading(val message: String) : UiState()
        object Ready : UiState()
        object Success : UiState()
        data class Error(val message: String) : UiState()
        object ModelNotFound : UiState()
    }
}
```

### 5. UI ç•Œé¢

```kotlin
// ui/screens/MainScreen.kt
@Composable
fun MainScreen(viewModel: MainViewModel = viewModel()) {
    val uiState by viewModel.uiState.collectAsState()
    val recommendations by viewModel.recommendations.collectAsState()
    val isModelReady by viewModel.isModelReady.collectAsState()
    
    var selectedImage by remember { mutableStateOf<Bitmap?>(null) }
    var textQuery by remember { mutableStateOf("") }
    
    val launcher = rememberLauncherForActivityResult(
        ActivityResultContracts.GetContent()
    ) { uri ->
        uri?.let { loadBitmap(it) }?.let { selectedImage = it }
    }
    
    val cameraLauncher = rememberLauncherForActivityResult(
        ActivityResultContracts.TakePicturePreview()
    ) { bitmap ->
        bitmap?.let { selectedImage = it }
    }
    
    Scaffold(
        topBar = {
            TopAppBar(
                title = { Text("é¤é£Ÿå†³ç­–åŠ©æ‰‹") },
                actions = {
                    IconButton(onClick = { /* è®¾ç½® */ }) {
                        Icon(Icons.Default.Settings, "è®¾ç½®")
                    }
                }
            )
        },
        floatingActionButton = {
            if (isModelReady) {
                ExtendedFloatingActionButton(
                    onClick = { viewModel.quickRecommend() },
                    icon = { Icon(Icons.Default.Restaurant, null) },
                    text = { Text("å¸®æˆ‘é€‰") }
                )
            }
        }
    ) { padding ->
        Column(
            modifier = Modifier
                .fillMaxSize()
                .padding(padding)
                .padding(16.dp),
            verticalArrangement = Arrangement.spacedBy(16.dp)
        ) {
            // çŠ¶æ€æ˜¾ç¤º
            when (val state = uiState) {
                is MainViewModel.UiState.Loading -> {
                    LinearProgressIndicator(modifier = Modifier.fillMaxWidth())
                    Text(state.message, style = MaterialTheme.typography.bodyMedium)
                }
                is MainViewModel.UiState.Error -> {
                    Card(colors = CardDefaults.cardColors(containerColor = MaterialTheme.colorScheme.errorContainer)) {
                        Text(
                            state.message,
                            modifier = Modifier.padding(16.dp),
                            color = MaterialTheme.colorScheme.onErrorContainer
                        )
                    }
                }
                is MainViewModel.UiState.ModelNotFound -> {
                    ModelDownloadCard(onDownload = { /* è§¦å‘ä¸‹è½½ */ })
                }
                else -> {}
            }
            
            // å›¾ç‰‡è¾“å…¥åŒºåŸŸ
            Card(
                modifier = Modifier.fillMaxWidth(),
                onClick = { /* é€‰æ‹©å›¾ç‰‡æ¥æº */ }
            ) {
                Box(
                    modifier = Modifier
                        .fillMaxWidth()
                        .height(200.dp),
                    contentAlignment = Alignment.Center
                ) {
                    if (selectedImage != null) {
                        Image(
                            bitmap = selectedImage!!.asImageBitmap(),
                            contentDescription = "å·²é€‰å›¾ç‰‡",
                            modifier = Modifier.fillMaxSize(),
                            contentScale = ContentScale.Crop
                        )
                    } else {
                        Column(horizontalAlignment = Alignment.CenterHorizontally) {
                            Icon(Icons.Default.AddAPhoto, null, modifier = Modifier.size(48.dp))
                            Text("ç‚¹å‡»æ‹ç…§æˆ–é€‰æ‹©å›¾ç‰‡")
                        }
                    }
                }
            }
            
            // æ–‡å­—è¾“å…¥
            OutlinedTextField(
                value = textQuery,
                onValueChange = { textQuery = it },
                label = { Text("è¡¥å……æè¿°ï¼ˆå¯é€‰ï¼‰") },
                placeholder = { Text("æ¯”å¦‚ï¼šæƒ³åƒæ¸…æ·¡ä¸€ç‚¹çš„") },
                modifier = Modifier.fillMaxWidth()
            )
            
            // æ“ä½œæŒ‰é’®
            Row(
                modifier = Modifier.fillMaxWidth(),
                horizontalArrangement = Arrangement.spacedBy(8.dp)
            ) {
                OutlinedButton(
                    onClick = { cameraLauncher.launch(null) },
                    modifier = Modifier.weight(1f)
                ) {
                    Icon(Icons.Default.CameraAlt, null)
                    Spacer(Modifier.width(4.dp))
                    Text("æ‹ç…§")
                }
                OutlinedButton(
                    onClick = { launcher.launch("image/*") },
                    modifier = Modifier.weight(1f)
                ) {
                    Icon(Icons.Default.PhotoLibrary, null)
                    Spacer(Modifier.width(4.dp))
                    Text("ç›¸å†Œ")
                }
                Button(
                    onClick = { viewModel.getRecommendation(selectedImage, textQuery) },
                    modifier = Modifier.weight(1f),
                    enabled = isModelReady
                ) {
                    Text("è·å–æ¨è")
                }
            }
            
            // æ¨èç»“æœå±•ç¤º
            recommendations.forEach { recommendation ->
                RecommendationCard(
                    recommendation = recommendation,
                    onLike = { viewModel.likeRecommendation(it) },
                    onDislike = { viewModel.dislikeRecommendation(it) }
                )
            }
        }
    }
}

@Composable
fun RecommendationCard(
    recommendation: Recommendation,
    onLike: (Recommendation) -> Unit,
    onDislike: (Recommendation) -> Unit
) {
    Card(modifier = Modifier.fillMaxWidth()) {
        Column(modifier = Modifier.padding(16.dp)) {
            Text(
                recommendation.foodName,
                style = MaterialTheme.typography.headlineSmall
            )
            Text(
                recommendation.cuisine,
                style = MaterialTheme.typography.labelMedium,
                color = MaterialTheme.colorScheme.primary
            )
            Spacer(Modifier.height(8.dp))
            Text(recommendation.reason)
            
            Row(
                modifier = Modifier.fillMaxWidth(),
                horizontalArrangement = Arrangement.End
            ) {
                IconButton(onClick = { onDislike(recommendation) }) {
                    Icon(Icons.Default.ThumbDown, "ä¸å–œæ¬¢")
                }
                IconButton(onClick = { onLike(recommendation) }) {
                    Icon(Icons.Default.ThumbUp, "å–œæ¬¢")
                }
            }
        }
    }
}
```

## ğŸ“± ä¸‹ä¸€æ­¥

æ ¸å¿ƒåŠŸèƒ½å¼€å‘å®Œæˆåï¼Œè¿›å…¥ [04-ä¼˜åŒ–è°ƒè¯•.md](04-ä¼˜åŒ–è°ƒè¯•.md) è¿›è¡Œæ€§èƒ½ä¼˜åŒ–å’Œé—®é¢˜æ’æŸ¥ã€‚
